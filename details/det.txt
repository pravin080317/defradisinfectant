Multiple Council Access Feature Overview
Purpose:
To allow a portal user (typically third-party providers such as Capita) to access and manage records for multiple councils (Billing Authorities) via the LA Portal. This feature enables users to switch between councils they represent without requiring multiple user accounts.

Core Implementation Details:
Many-to-Many Relationship between Contact and Account (Council):

A custom many-to-many (N:N) relationship is established between the Contact entity and Account entity (representing Billing Authorities).

This allows a single user (Contact) to be related to multiple councils.

The current active account is still handled via the standard Active Account lookup field on the contact record.

Represents Multiple Switch:

A custom boolean field VOA_p_representsmultiple (Yes/No) is added to the Contact table.

If set to Yes, the user will be presented with the option to switch between councils they are associated with.

If set to No, the portal functions as it does today, limiting the user to their single assigned council.

Portal Changes:

A custom GDS-styled web template was implemented called "VOA GDS Choose an Account", linked to a portal webpage (e.g., "Choose a Billing Authority").

The page retrieves all related councils using a FetchXML query based on the many-to-many relationship.

The user is presented with a list of councils they have access to and can switch between them.

Active Account Switch Logic:

Upon selecting a council, the system updates the Active Account lookup in the Contact record (via a custom OData API call).

The active account switch dynamically filters the portal data and user experience, reflecting the selected council’s records.

UI Changes in Portal Dashboard:

A “Change” button is added next to the Billing Authority on the portal dashboard.

Clicking this triggers the user to the “Choose Billing Authority” screen where they can select a different council.

Portal User Setup Process (Current Limitation):

Current user onboarding process (via Portal User Setup table) does not yet handle this multiple-account relationship.

Further enhancement is needed to extend the setup process to:

Allow selection of multiple councils during onboarding.

Automatically create the relationship records in Dataverse.

Next Steps Identified:
Review user setup workflows to integrate multiple council relationship creation.

Ensure portal table permissions (on Contact & Account entities) allow for this enhanced visibility.

Fine-tune the UX around switching councils and handle cache/session management post-switch.





 User Story: Implement Multiple Council Access Switching
Title: Enable Portal Users to Switch Between Multiple Councils

Description:
As a portal user representing multiple councils (Billing Authorities), I want to be able to switch between the councils I manage, so that I can access and submit data on behalf of each council as needed.

Implement many-to-many relationship between Contact and Account entities.

Display available councils on a new "Choose Billing Authority" page when applicable.

Update the Active Account field based on user selection via portal.

Ensure proper UX with a "Change" button on the portal dashboard.

2. Task: Enhance Portal User Setup Process for Multi-Council Users
Title: Extend Portal User Setup to Handle Multi-Council Relationships

Description:
Update the existing Portal User Setup process to include the option to assign multiple councils to a user.

Allow admins to select multiple related councils during user onboarding.

Automatically create contact-account relationships in Dataverse.

Ensure this process aligns with existing contact creation workflows.

3. Task: Review and Adjust Portal Permissions
Title: Update Portal Table Permissions for Multi-Council Feature

Description:
Adjust Dataverse security roles and portal table permissions to ensure users can access their multiple assigned councils correctly.

Review permissions for Contact and Account tables.

Ensure proper filtering of data based on active account context.

4. Task: Refactor & Optimize Choose Billing Authority Page
Title: Finalize UI/UX for "Choose Billing Authority" Page

Description:
Improve the user interface and logic of the "Choose Billing Authority" page to provide a seamless switching experience for multi-council users.

Validate FetchXML queries for retrieving multiple accounts.

Refine front-end presentation based on GDS standards.

Handle user session/cache refresh post account switch.
