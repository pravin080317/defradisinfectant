pageViews
| extend 
    userId = tostring(customDimensions.userId),
    sessionId = tostring(customDimensions.sessionId)
| summarize 
    sessionStart = min(timestamp),
    sessionEnd = max(timestamp)
  by sessionId, userId
| mv-expand activeTime = range(sessionStart, sessionEnd, 1m)
| summarize concurrentUsers = dcount(userId) by bin(activeTime, 1m)
| order by activeTime asc
