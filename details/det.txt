Runbook: Schedules List Plugin

Overview

The Schedules List Plugin is a Dataverse plugin designed to dynamically retrieve and display a list of council tax schedule documents through integration with the VOA (Valuation Office Agency) internal API. The plugin leverages secure authentication, structured API requests, and real-time data retrieval without persisting sensitive data directly within Dataverse.

Execution Workflow

Step 1: Plugin Invocation

Triggered by user interaction from PowerApps Portals requesting council tax schedules.

Validates the plugin execution context to ensure all necessary inputs and services are available.

Step 2: Secure Credentials Retrieval

Retrieves API credentials securely from the voa_CredentialProvider custom action.

Credentials obtained include:

API Base URL

Client ID

Client Secret

API Management Subscription Key

Scope

Tenant ID

Step 3: OAuth2 Authentication

Utilizes OAuth2 protocol to securely generate an authentication token.

The token is essential for authenticating subsequent API requests.

Step 4: API Request Construction & Execution

Constructs an API request to fetch schedule metadata based on provided parameters (BACode, FileType).

API Endpoint:

https://voagw.npd.hmrc.gov.uk/dev/internal/bst/property-app/v1/laSchedule/metadata?bacode={BACode}&filetype={FileType}

The request includes authorization headers (Bearer Token) and subscription key for secure access.

Step 5: Processing the API Response

Parses the JSON response received from the VOA API.

Converts the response into structured Dataverse-compatible entities.

Step 6: Data Population into Virtual Table

Dynamically populates the retrieved records into the Dataverse virtual table (voap_portalscheduleslist).

Key fields populated include:

voap_id

voap_groupid

voap_bacode

voap_listid

voap_listyear

voap_listtype

voap_billingauthorityid

voap_filetype

voap_filepath

voap_filesize

voap_filename

voap_description

voap_language

voap_createddate

Dataverse Virtual Table Used

Virtual Table Name

Description

Operation

voap_portalscheduleslist

Temporarily stores retrieved schedule details for immediate display

Insert/Update

Logging & Monitoring

The plugin utilizes Dataverse's TracingService for logging detailed execution steps, API request URLs, response statuses, and any encountered exceptions. This facilitates debugging, performance monitoring, and quick resolution of issues.

Deployment & Maintenance

Configuration Requirements

Ensure correct configuration of the virtual entity (voap_portalscheduleslist) within Dataverse.

Secure storage and regular verification of API credentials within the voa_CredentialProvider.

PowerApps Portal must be properly configured to interact with the virtual table for real-time data display.

Routine Maintenance Checklist

Regularly verify the availability and responsiveness of the VOA internal API.

Periodically validate OAuth2 tokens and API credential validity.

Monitor Dataverse logs regularly to ensure smooth plugin operation and quickly identify issues.

Conclusion

The Schedules List Plugin provides secure, reliable, and real-time access to council tax schedules through seamless integration with Dataverse and the VOA API, enhancing user experience and operational efficiency.
