function showErrorMessage(inputId, message, insertBeforeSelector) {
  const field = document.getElementById(inputId);
  if (!field) return;

  let errorElement = document.getElementById(`${inputId}-error`);
  if (!errorElement) {
    errorElement = document.createElement("p");
    errorElement.className = "govuk-error-message";
    errorElement.id = `${inputId}-error`;
    errorElement.setAttribute("aria-live", "assertive");
    errorElement.innerHTML = `<span class="govuk-visually-hidden">Error:</span> ${message}`;

    if (insertBeforeSelector) {
      const referenceNode = document.querySelector(insertBeforeSelector);
      if (referenceNode && referenceNode.parentNode) {
        referenceNode.parentNode.insertBefore(errorElement, referenceNode);
      } else {
        field.parentNode.insertBefore(errorElement, field);
      }
    } else {
      field.parentNode.insertBefore(errorElement, field);
    }
  } else {
    errorElement.style.display = "block";
    errorElement.innerHTML = `<span class="govuk-visually-hidden">Error:</span> ${message}`;
  }

  field.setAttribute("aria-describedby", `${inputId}-error`);
  field.setAttribute("aria-invalid", "true");
}
