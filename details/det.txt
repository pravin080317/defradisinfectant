DECLARE @xml_body XML;

SET @xml_body =
(
    SELECT
        (
            SELECT 
                -- Billing Authority Report with aria-hidden only if blank
                (
                    SELECT 
                        CASE 
                            WHEN ISNULL(CTO.[Billing Authority Report], '') = '' THEN 
                                '<td aria-hidden="true"></td>' 
                            ELSE 
                                '<td>' + CAST(CTO.[Billing Authority Report] AS NVARCHAR(MAX)) + '</td>' 
                        END AS [text()]
                    FOR XML PATH(''), TYPE
                ),

                -- Property Address with aria-hidden only if blank
                (
                    SELECT 
                        CASE 
                            WHEN ISNULL(CTO.[Property Address], '') = '' THEN 
                                '<td aria-hidden="true"></td>' 
                            ELSE 
                                '<td>' + CAST(CTO.[Property Address] AS NVARCHAR(MAX)) + '</td>' 
                        END AS [text()]
                    FOR XML PATH(''), TYPE
                ),

                -- Property Reference with aria-hidden only if blank
                (
                    SELECT 
                        CASE 
                            WHEN ISNULL(CTO.[Property Reference], '') = '' THEN 
                                '<td aria-hidden="true"></td>' 
                            ELSE 
                                '<td>' + CAST(CTO.[Property Reference] AS NVARCHAR(MAX)) + '</td>' 
                        END AS [text()]
                    FOR XML PATH(''), TYPE
                )

            FROM #CT_Outstanding CTO
            ORDER BY 
                CTO.town_no ASC,
                CTO.street,
                CTO.postcode,
                CTO.building_number_int,
                CTO.building_number,
                CTO.building_name,
                CTO.sub_building_identifier
            FOR XML PATH('tr'), TYPE
        )
);
