function selectAccount(event) {
  event.preventDefault();

  const account = event.target;
  const newCouncilId = account.getAttribute('value');
  const newCouncilName = account.innerText?.trim();
  const prevCouncilId = sessionStorage.getItem("activeCouncilId");

  updateNewActiveAccount(newCouncilId)
    .then(() => {
      // Update active council in sessionStorage
      if (newCouncilId && newCouncilId !== prevCouncilId) {
        sessionStorage.setItem("activeCouncilId", newCouncilId);

        // âœ… Safely track council switch event if App Insights is present
        try {
          if (window.appInsights && typeof window.appInsights.trackEvent === "function") {
            window.appInsights.trackEvent({
              name: "CouncilSwitched",
              properties: {
                userId: "{{ user.id | default: 'Anonymous' }}",
                userName: "{{ user.fullname | default: 'N/A' }}",
                previousCouncilId: prevCouncilId || "Unknown",
                newCouncilId: newCouncilId,
                newCouncilName: newCouncilName,
                switchTime: new Date().toISOString()
              }
            });
          } else {
            console.warn("App Insights not available on this page.");
          }
        } catch (err) {
          console.error("App Insights tracking failed:", err);
        }
      }

      // Redirect to dashboard
      newAccountPage();
    })
    .catch(function (error) {
      console.error("Error updating council:", error);
    });
}
