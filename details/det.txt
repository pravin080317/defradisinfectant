let
    // Step 1: Filter Header
    SourceHeader = voa_frontdoorheader,
    FilteredHeader = Table.SelectRows(
        SourceHeader,
        each [voa_typecodename] = "EBARS" and
             [voa_isvestibulename] = "No" and
             [createdon] >= #datetime(2025, 8, 1, 0, 0, 0) and
             [createdon] <  #datetime(2025, 9, 1, 0, 0, 0)
    ),

    // Step 2: Filter Row
    SourceRow = voa_frontdoorrow,
    FilteredRow = Table.SelectRows(
        SourceRow,
        each [statuscodename] = "Completed Sent To Case"
    ),

    // Step 3: Join Row → Account (billing authority lookup)
    RowWithAccount = Table.NestedJoin(
        FilteredRow,
        {"voa_billingauthorityid"},
        account,
        {"accountid"},
        "AccountTable",
        JoinKind.Inner
    ),
    ExpandedRowAccount = Table.ExpandTableColumn(
        RowWithAccount,
        "AccountTable",
        {"voa_baccodeacc"},
        {"voa_baccodeacc"}
    ),

    // Step 4: Keep only slim columns
    RowSlim = Table.SelectColumns(
        ExpandedRowAccount,
        {"voa_frontdoorheaderid", "voa_baccodeacc"}
    ),

    // Step 5: Join Header → RowSlim
    Joined = Table.NestedJoin(
        FilteredHeader,
        {"voa_frontdoorheaderid"},
        RowSlim,
        {"voa_frontdoorheaderid"},
        "RowSlimTable",
        JoinKind.Inner
    ),
    ExpandedJoined = Table.ExpandTableColumn(
        Joined,
        "RowSlimTable",
        {"voa_baccodeacc"},
        {"voa_baccodeacc"}
    ),

    // Step 6: Remove null BA Codes
    Cleaned = Table.SelectRows(
        ExpandedJoined,
        each [voa_baccodeacc] <> null
    ),

    // Step 7: Group by BA Code → Count files
    Grouped = Table.Group(
        Cleaned,
        {"voa_baccodeacc"},
        {{"Count Of Files", each Table.RowCount(_), Int64.Type}}
    ),

    // Step 8: Rename column
    Final = Table.RenameColumns(
        Grouped,
        {{"voa_baccodeacc", "Ba Code"}}
    )
in
    Final
